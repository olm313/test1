Интеграция по REST-протоколу
============================

Введение
--------
В данном документе представлена документация по протоколу REST для отправки разных типов сообщений, в документации содержится необходимая информация для настройки, описание основных параметров сообщений и примеры для отправки сообщений.

Описание
~~~~~~~~
Rest API v.1.0 платформы Сервис-провайдера позволяет интегрировать в системы клиента отправку сообщений и получение статусов отправленных сообщений по протоколу REST. Платформа предоставляет возможность отправлять входящий и исходящий трафик (далее – MT- или MO-трафик). Поддерживаются следующие типы сообщений:

* SMS;

* Viber;

* Push;

* VK;

* WhatsApp;

* CARDSMOBILE;

* FlashingCall.

.. note:: Тип сообщения CARDSMOBILE относится только к приложению “Кошелёк“.

Подключение сервиса
~~~~~~~~~~~~~~~~~~~
Для подключения сервиса Партнёр должен предоставить Сервис-провайдеру следующие данные:

* набор IP-подсетей (адрес и маска каждой подсети) Партнёра;

* имя отправителя, с которого будут отправляться сообщения абонентам;

* URL для получения статусов доставки.

Для доступа к сервису Партнёр получает от Сервис-провайдера следующие параметры:

* login – имя Партнёра. Заводится Сервис-провайдером при подключении сервиса Партнёра;

* password – пароль Партнёра для отправки сообщений. Пароль заводится Сервис-провайдером при подключении Партнёра.

Взаимодействие с платформой Сервис-провайдера осуществляется через REST API с помощью стандартных HTTP-запросов. Партнёр для отправки сообщения абоненту вызывает URL Сервис-провайдера и передает номер абонента, текст сообщения и прочие параметры. Сервис-провайдер принимает запрос, отправляет сообщение абоненту и возвращает Партнёру идентификатор сообщения в теле ответа на запрос.

*Структура запроса:*

* URI (предоставляется Сервис-провайдером);

* тип запроса - POST;

* Content-Type - application/json;

* кодировка символов - предпочтительно UTF-8. Но партнер сам в заголовке запроса может указать желаемую кодировку, в которой Сервис-провайдер будет пытаться вычитать запрос.

Параметры сообщений
-------------------

Параметры запроса для отправки сообщения
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. list-table:: Таблица в виде списка
   :widths: 10 10 15 10
   :header-rows: 1

   * - Параметр
     - Тип
     - Описание
     - Обязательность
   * - login
     - string
     - Имя Партнёра. Заводится Сервис-провайдером при подключении сервиса Партнёра и сообщается последнему
     - ``+``
   * - password
     - string
     - Пароль Партнёра для отправки сообщений. Пароль заводится Сервис-провайдером при подключении Партнёра и сообщается ему
     - ``+``
   * - extraParam
     - string
     - Дополнительные параметры, передаваемые в виде "param1=value1,param2=value2", где param1 и param2 – названия параметров, value1 и value2 – значение. Символ запятой в название параметра входить не может, но может входить в его значение - в этом случае он должен удваиваться. Пример: строка место=абзаково,название=гостевой дом-2,координаты=53.8085896,, 58.6362112,c=23.02.09,по=05.03.09
     - ``-``

.. csv-table:: CSV-таблица
   :header: "Параметр", "Тип", "Описание", "Обязательность"
   :widths: 10, 10, 15, 10

   "login", "string", "Имя Партнёра. Заводится Сервис-провайдером при подключении сервиса Партнёра и сообщается последнему", ``+``
   "password", "string", "Пароль Партнёра для отправки сообщений. Пароль заводится Сервис-провайдером при подключении Партнёра и сообщается ему", ``+``
   "extraParam", "string", "Дополнительные параметры, передаваемые в виде ``param1=value1,param2=value2``, где param1 и param2 – названия параметров, value1 и value2 – значение. Символ запятой в название параметра входить не может, но может входить в его значение - в этом случае он должен удваиваться. Пример: строка место=абзаково,название=гостевой дом-2,координаты=53.8085896,, 58.6362112,c=23.02.09,по=05.03.09", ``-``
   

Отправка сообщений
------------------
SMS
~~~

.. tabs::

    .. tab:: SMS

       :: {
          "login":"ВАШ_ЛОГИН",
          "password":"ВАШ_ПАРОЛЬ",
          "useTimeDiff":true,
          "id":"8770630",
          "shortenLinks":false,
          "scheduleInfo":{
            "timeBegin":"10:00",
            "timeEnd":"12:00",
            "weekdaysSchedule":"123"
          },
          "destAddr":"Номер_Абонента",
          "message":{
          "type":"SMS",
          "data":{
           "text":"Текст. Follow link: <http://verylongurl.com/very/long/url>",
           "serviceNumber":"НОМЕР_ОТПРАВИТЕЛЯ",
           "ttl":10
             }
          }
        }

Viber
~~~~~

.. tabs::

    .. tab:: Viber-сообщение (текст + изображение + кнопка)
       :: {
            "login":"ВАШ_ЛОГИН",
            "password":"ВАШ_ПАРОЛЬ",
            "useTimeDiff":false,
            "id":"8770100",
            "scheduleInfo":
            {
               "timeBegin":"10:00",
               "timeEnd":"20:00",
               "weekdaysSchedule":"12345"
            },
            "destAddr":"Номер_Абонента",
            "message":
            {
               "type":"VIBER",
               "data":
               {
                  "instantContent":
                  {
                     "type":"BUTTON",
                     "data":
                     {
                        "text":"VIBERMESS",
                        "imageURL":"https://example.ru/image",
                        "caption":"ПЕРЕЙТИ",
                        "action":"https:// example.ru/image"
                     }
                  },
                  "serviceNumber":"НОМЕР_ОТПРАВИТЕЛЯ",
                  "ttl":1
               }
            }
      }
